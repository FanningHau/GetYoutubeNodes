name: æ¯æ—¥æå–å¹¶æ›´æ–°å†…å®¹

on:
  schedule:
    # æ¯å¤© 10:00 (UTC æ—¶é—´) è¿è¡Œ
    - cron: '0 10 * * *'
  
  workflow_dispatch:

jobs:
  download-and-commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          # (!!) ä¿®æ”¹ç‚¹ï¼šåœ¨è¿™é‡ŒåŠ ä¸Š pyzipper
          pip install google-api-python-client gdown pyzipper
      
      - name: Run Python script
        run: python getnodes_modified.py 
        env:
          YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}
          VIDEO_ID: ${{ secrets.VIDEO_ID }}        
          ZIP_PASSWORD: ${{ secrets.ZIP_PASSWORD }}    

      - name: Commit and push extracted content
        run: |
          git config --global user.name 'fanning'
          git config --global user.email 'haofanning@gmail.com'
          
          git add .
          
          if [ -z "$(git status --porcelain)" ]; then
            echo "âœ… å†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œæ— éœ€æäº¤ã€‚"
          else
            echo "ğŸš€ å‘ç°å†…å®¹æ›´æ–°ï¼Œæ­£åœ¨æäº¤..."
            # (å»ºè®®) åŠ ä¸Š [skip ci] é˜²æ­¢æ— é™å¾ªç¯ï¼Œè™½éå¿…é¡»ä½†æ¨è
            git commit -m "Automated update: æå–å¹¶æ›´æ–°è®¢é˜…å†…å®¹ (${{ env.TODAY_DATE }}) [skip ci]"
            git push
          fi
        env:
          TODAY_DATE: $(date +'%Y-%m-%d')
